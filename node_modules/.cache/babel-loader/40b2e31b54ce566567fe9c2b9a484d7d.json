{"remainingRequest":"/Users/will/Downloads/plugiin/node_modules/thread-loader/dist/cjs.js!/Users/will/Downloads/plugiin/node_modules/babel-loader/lib/index.js!/Users/will/Downloads/plugiin/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/will/Downloads/plugiin/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/will/Downloads/plugiin/src/views/signature/Signature.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/will/Downloads/plugiin/src/views/signature/Signature.vue","mtime":1574819910000},{"path":"/Users/will/Downloads/plugiin/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/will/Downloads/plugiin/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/will/Downloads/plugiin/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/will/Downloads/plugiin/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/will/Downloads/plugiin/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["\"use strict\";\n\nvar _interopRequireDefault = require(\"/Users/will/Downloads/plugiin/node_modules/@babel/runtime-corejs2/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nrequire(\"core-js/modules/es6.regexp.replace\");\n\nrequire(\"regenerator-runtime/runtime\");\n\nvar _asyncToGenerator2 = _interopRequireDefault(require(\"/Users/will/Downloads/plugiin/node_modules/@babel/runtime-corejs2/helpers/esm/asyncToGenerator\"));\n\nvar _sign = require(\"@/api/sign\");\n\nvar _vant = require(\"vant\");\n\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nvar _default = {\n  data: function data() {\n    return {\n      // signJSONArr: []\n      signJson: '',\n      signReturnData: ''\n    };\n  },\n  created: function () {\n    var _created = (0, _asyncToGenerator2.default)(\n    /*#__PURE__*/\n    regeneratorRuntime.mark(function _callee() {\n      var background;\n      return regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              background = chrome.extension.getBackgroundPage();\n              this.signJson = background.signJson();\n              this.signReturnData = JSON.parse(this.signJson);\n\n            case 3:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, this);\n    }));\n\n    function created() {\n      return _created.apply(this, arguments);\n    }\n\n    return created;\n  }(),\n  computed: function computed() {},\n  methods: {\n    // 取消\n    refuse: function refuse() {\n      // 清除 badge \n      chrome.runtime.sendMessage({\n        type: 'SIGNJSONRETURN',\n        data: this.signJson\n      }, function (response) {}); // 跳转到钱包主页\n\n      this.$router.replace({\n        path: '/money-bag'\n      }); // TODO: 向页面发送取消请求\n\n      this.sendMessageToContentScript({\n        msg: '取消你的签名请求',\n        type: 'SIGNDATARETURN',\n        status: false\n      }, function (response) {\n        console.log(response);\n      });\n    },\n    agree: function () {\n      var _agree = (0, _asyncToGenerator2.default)(\n      /*#__PURE__*/\n      regeneratorRuntime.mark(function _callee2() {\n        var _this = this;\n\n        var keypair, ecHexSign, params;\n        return regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                if (!this.signReturnData) {\n                  _context2.next = 12;\n                  break;\n                }\n\n                _vant.Toast.loading({\n                  duration: 0,\n                  mask: true,\n                  message: '签名中...'\n                }); // 获取 keypair\n\n\n                keypair = '';\n                _context2.next = 5;\n                return this.$unit.getStorage('keypair').then(function (v) {\n                  keypair = JSON.stringify(v);\n                });\n\n              case 5:\n                console.log('keypair', JSON.parse(keypair).hexPrikey);\n                console.log('this.signHexData', this.signReturnData); // 通过私钥和第一次请求返回的hashData进行数据签名\n\n                ecHexSign = this.$cwv2.ecHexSign(JSON.parse(keypair).hexPrikey, this.signReturnData.hexdata);\n                console.log('ecHexSign', ecHexSign);\n                params = {\n                  signdata: ecHexSign,\n                  method: this.signReturnData.method,\n                  waitResp: this.signReturnData.waitResp || false,\n                  from: this.signReturnData.from,\n                  hexdata: this.signReturnData.hexdata,\n                  refid: this.signReturnData.refid,\n                  resp_refid: this.signReturnData.resp_refid\n                };\n                console.log('send_sign', params); // 签名请求\n\n                (0, _sign.sendSignData)(params).then(function (res) {\n                  console.log('res', res);\n\n                  if (res.status === 200 && res.data.ret_code >= 0) {\n                    // 清除 badge \n                    chrome.runtime.sendMessage({\n                      type: 'SIGNJSONRETURN',\n                      data: _this.signJson\n                    }, function (response) {}); // 向页面发送成功签名请求数据\n\n                    _this.sendMessageToContentScript({\n                      msg: '同意了你的签名请求',\n                      type: 'SIGNDATARETURN',\n                      data: res.data,\n                      status: true\n                    }, function (response) {\n                      console.log(response);\n                    }); // 清除加载\n\n\n                    _vant.Toast.clear(); // 跳转到钱包主页\n\n\n                    _this.$router.replace({\n                      path: '/money-bag'\n                    });\n                  } else if (res.status === 200 && res.data.ret_code < 0) {\n                    // 签名异常后\n                    // 清除 badge \n                    chrome.runtime.sendMessage({\n                      type: 'SIGNJSONRETURN',\n                      data: _this.signJson\n                    }, function (response) {}); // 向页面发送异常请求\n\n                    _this.sendMessageToContentScript({\n                      msg: '你的签名请求异常',\n                      type: 'SIGNDATARETURN',\n                      status: false\n                    }, function (response) {\n                      console.log(response);\n                    }); // 提示异常信息\n\n\n                    _vant.Toast.clear();\n\n                    (0, _vant.Toast)(res.data.ret_message);\n                  }\n                }).catch(function (err) {\n                  console.log(err);\n\n                  _vant.Toast.clear(); // 向页面发送异常请求\n\n\n                  _this.sendMessageToContentScript({\n                    msg: '你的签名请求失败',\n                    type: 'SIGNDATARETURN',\n                    status: false\n                  }, function (response) {\n                    console.log(response);\n                  });\n                });\n\n              case 12:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, this);\n      }));\n\n      function agree() {\n        return _agree.apply(this, arguments);\n      }\n\n      return agree;\n    }(),\n    getCurrentTabId: function getCurrentTabId(callback) {\n      chrome.tabs.query({\n        active: true,\n        currentWindow: true\n      }, function (tabs) {\n        if (callback) callback(tabs.length ? tabs[0].id : null);\n      });\n    },\n    sendMessageToContentScript: function sendMessageToContentScript(message, callback) {\n      this.getCurrentTabId(function (tabId) {\n        chrome.tabs.sendMessage(tabId, message, function (response) {\n          if (callback) callback(response);\n        });\n      });\n    }\n  }\n};\nexports.default = _default;",{"version":3,"sources":["Signature.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;AAYA;;AACA;;;;;;;;;;;;;eACA;AACA,EAAA,IADA,kBACA;AACA,WAAA;AACA;AACA,MAAA,QAAA,EAAA,EAFA;AAGA,MAAA,cAAA,EAAA;AAHA,KAAA;AAKA,GAPA;AAQA,EAAA,OARA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AASA,cAAA,UATA,GASA,MAAA,CAAA,SAAA,CAAA,iBAAA,EATA;AAUA,mBAAA,QAAA,GAAA,UAAA,CAAA,QAAA,EAAA;AACA,mBAAA,cAAA,GAAA,IAAA,CAAA,KAAA,CAAA,KAAA,QAAA,CAAA;;AAXA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAaA,EAAA,QAbA,sBAaA,CAAA,CAbA;AAcA,EAAA,OAAA,EAAA;AACA;AACA,IAAA,MAFA,oBAEA;AACA;AACA,MAAA,MAAA,CAAA,OAAA,CAAA,WAAA,CAAA;AACA,QAAA,IAAA,EAAA,gBADA;AAEA,QAAA,IAAA,EAAA,KAAA;AAFA,OAAA,EAGA,UAAA,QAAA,EAAA,CAAA,CAHA,EAFA,CAMA;;AACA,WAAA,OAAA,CAAA,OAAA,CAAA;AACA,QAAA,IAAA,EAAA;AADA,OAAA,EAPA,CAUA;;AACA,WAAA,0BAAA,CAAA;AAAA,QAAA,GAAA,EAAA,UAAA;AAAA,QAAA,IAAA,EAAA,gBAAA;AAAA,QAAA,MAAA,EAAA;AAAA,OAAA,EAAA,UAAA,QAAA,EAAA;AACA,QAAA,OAAA,CAAA,GAAA,CAAA,QAAA;AACA,OAFA;AAGA,KAhBA;AAiBA,IAAA,KAjBA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,qBAkBA,KAAA,cAlBA;AAAA;AAAA;AAAA;;AAmBA,4BAAA,OAAA,CAAA;AACA,kBAAA,QAAA,EAAA,CADA;AAEA,kBAAA,IAAA,EAAA,IAFA;AAGA,kBAAA,OAAA,EAAA;AAHA,iBAAA,EAnBA,CAwBA;;;AACA,gBAAA,OAzBA,GAyBA,EAzBA;AAAA;AAAA,uBA0BA,KAAA,KAAA,CAAA,UAAA,CAAA,SAAA,EAAA,IAAA,CAAA,UAAA,CAAA,EAAA;AACA,kBAAA,OAAA,GAAA,IAAA,CAAA,SAAA,CAAA,CAAA,CAAA;AACA,iBAFA,CA1BA;;AAAA;AA6BA,gBAAA,OAAA,CAAA,GAAA,CAAA,SAAA,EAAA,IAAA,CAAA,KAAA,CAAA,OAAA,EAAA,SAAA;AACA,gBAAA,OAAA,CAAA,GAAA,CAAA,kBAAA,EAAA,KAAA,cAAA,EA9BA,CA+BA;;AACA,gBAAA,SAhCA,GAgCA,KAAA,KAAA,CAAA,SAAA,CAAA,IAAA,CAAA,KAAA,CAAA,OAAA,EAAA,SAAA,EAAA,KAAA,cAAA,CAAA,OAAA,CAhCA;AAiCA,gBAAA,OAAA,CAAA,GAAA,CAAA,WAAA,EAAA,SAAA;AACA,gBAAA,MAlCA,GAkCA;AACA,kBAAA,QAAA,EAAA,SADA;AAEA,kBAAA,MAAA,EAAA,KAAA,cAAA,CAAA,MAFA;AAGA,kBAAA,QAAA,EAAA,KAAA,cAAA,CAAA,QAAA,IAAA,KAHA;AAIA,kBAAA,IAAA,EAAA,KAAA,cAAA,CAAA,IAJA;AAKA,kBAAA,OAAA,EAAA,KAAA,cAAA,CAAA,OALA;AAMA,kBAAA,KAAA,EAAA,KAAA,cAAA,CAAA,KANA;AAOA,kBAAA,UAAA,EAAA,KAAA,cAAA,CAAA;AAPA,iBAlCA;AA2CA,gBAAA,OAAA,CAAA,GAAA,CAAA,WAAA,EAAA,MAAA,EA3CA,CA4CA;;AACA,wCAAA,MAAA,EAAA,IAAA,CAAA,UAAA,GAAA,EAAA;AACA,kBAAA,OAAA,CAAA,GAAA,CAAA,KAAA,EAAA,GAAA;;AACA,sBAAA,GAAA,CAAA,MAAA,KAAA,GAAA,IAAA,GAAA,CAAA,IAAA,CAAA,QAAA,IAAA,CAAA,EAAA;AACA;AACA,oBAAA,MAAA,CAAA,OAAA,CAAA,WAAA,CAAA;AACA,sBAAA,IAAA,EAAA,gBADA;AAEA,sBAAA,IAAA,EAAA,KAAA,CAAA;AAFA,qBAAA,EAGA,UAAA,QAAA,EAAA,CAAA,CAHA,EAFA,CAMA;;AACA,oBAAA,KAAA,CAAA,0BAAA,CAAA;AAAA,sBAAA,GAAA,EAAA,WAAA;AAAA,sBAAA,IAAA,EAAA,gBAAA;AAAA,sBAAA,IAAA,EAAA,GAAA,CAAA,IAAA;AAAA,sBAAA,MAAA,EAAA;AAAA,qBAAA,EAAA,UAAA,QAAA,EAAA;AACA,sBAAA,OAAA,CAAA,GAAA,CAAA,QAAA;AACA,qBAFA,EAPA,CAUA;;;AACA,gCAAA,KAAA,GAXA,CAYA;;;AACA,oBAAA,KAAA,CAAA,OAAA,CAAA,OAAA,CAAA;AACA,sBAAA,IAAA,EAAA;AADA,qBAAA;AAGA,mBAhBA,MAgBA,IAAA,GAAA,CAAA,MAAA,KAAA,GAAA,IAAA,GAAA,CAAA,IAAA,CAAA,QAAA,GAAA,CAAA,EAAA;AACA;AACA;AACA,oBAAA,MAAA,CAAA,OAAA,CAAA,WAAA,CAAA;AACA,sBAAA,IAAA,EAAA,gBADA;AAEA,sBAAA,IAAA,EAAA,KAAA,CAAA;AAFA,qBAAA,EAGA,UAAA,QAAA,EAAA,CAAA,CAHA,EAHA,CAOA;;AACA,oBAAA,KAAA,CAAA,0BAAA,CAAA;AAAA,sBAAA,GAAA,EAAA,UAAA;AAAA,sBAAA,IAAA,EAAA,gBAAA;AAAA,sBAAA,MAAA,EAAA;AAAA,qBAAA,EAAA,UAAA,QAAA,EAAA;AACA,sBAAA,OAAA,CAAA,GAAA,CAAA,QAAA;AACA,qBAFA,EARA,CAWA;;;AACA,gCAAA,KAAA;;AACA,qCAAA,GAAA,CAAA,IAAA,CAAA,WAAA;AACA;AACA,iBAjCA,EAiCA,KAjCA,CAiCA,UAAA,GAAA,EAAA;AACA,kBAAA,OAAA,CAAA,GAAA,CAAA,GAAA;;AACA,8BAAA,KAAA,GAFA,CAGA;;;AACA,kBAAA,KAAA,CAAA,0BAAA,CAAA;AAAA,oBAAA,GAAA,EAAA,UAAA;AAAA,oBAAA,IAAA,EAAA,gBAAA;AAAA,oBAAA,MAAA,EAAA;AAAA,mBAAA,EAAA,UAAA,QAAA,EAAA;AACA,oBAAA,OAAA,CAAA,GAAA,CAAA,QAAA;AACA,mBAFA;AAGA,iBAxCA;;AA7CA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAwFA,IAAA,eAxFA,2BAwFA,QAxFA,EAwFA;AACA,MAAA,MAAA,CAAA,IAAA,CAAA,KAAA,CAAA;AAAA,QAAA,MAAA,EAAA,IAAA;AAAA,QAAA,aAAA,EAAA;AAAA,OAAA,EAAA,UAAA,IAAA,EAAA;AACA,YAAA,QAAA,EAAA,QAAA,CAAA,IAAA,CAAA,MAAA,GAAA,IAAA,CAAA,CAAA,CAAA,CAAA,EAAA,GAAA,IAAA,CAAA;AACA,OAFA;AAGA,KA5FA;AA6FA,IAAA,0BA7FA,sCA6FA,OA7FA,EA6FA,QA7FA,EA6FA;AACA,WAAA,eAAA,CAAA,UAAA,KAAA,EAAA;AACA,QAAA,MAAA,CAAA,IAAA,CAAA,WAAA,CAAA,KAAA,EAAA,OAAA,EAAA,UAAA,QAAA,EAAA;AACA,cAAA,QAAA,EAAA,QAAA,CAAA,QAAA,CAAA;AACA,SAFA;AAGA,OAJA;AAKA;AAnGA;AAdA,C","sourcesContent":["<template>\n  <div class=\"signature\">\n    <h2>Silent OTC</h2>\n    <p>请求签名</p>\n    <div class=\"button\">\n      <button class=\"refuse\" @click=\"refuse\">取消</button>\n      <button class=\"agree\" @click=\"agree\">同意</button>\n    </div>\n  </div>\n</template>\n\n<script>\nimport { getSignData, sendSignData } from '@/api/sign'\nimport { Toast } from 'vant'\nexport default {\n  data () {\n    return {\n      // signJSONArr: []\n      signJson: '',\n      signReturnData: '',\n    }\n  },\n  async created () {\n    let background = chrome.extension.getBackgroundPage()\n    this.signJson = background.signJson()\n    this.signReturnData = JSON.parse(this.signJson)\n  },\n  computed () { },\n  methods: {\n    // 取消\n    refuse () {\n      // 清除 badge \n      chrome.runtime.sendMessage({\n        type: 'SIGNJSONRETURN',\n        data: this.signJson\n      }, function (response) { })\n      // 跳转到钱包主页\n      this.$router.replace({\n        path: '/money-bag'\n      })\n      // TODO: 向页面发送取消请求\n      this.sendMessageToContentScript({ msg: '取消你的签名请求', type: 'SIGNDATARETURN', status: false }, (response) => {\n        console.log(response)\n      })\n    },\n    async agree () {\n      if (this.signReturnData) {\n        Toast.loading({\n          duration: 0,\n          mask: true,\n          message: '签名中...'\n        })\n        // 获取 keypair\n        let keypair = ''\n        await this.$unit.getStorage('keypair').then((v) => {\n          keypair = JSON.stringify(v)\n        })\n        console.log('keypair', JSON.parse(keypair).hexPrikey)\n        console.log('this.signHexData', this.signReturnData)\n        // 通过私钥和第一次请求返回的hashData进行数据签名\n        let ecHexSign = this.$cwv2.ecHexSign(JSON.parse(keypair).hexPrikey, this.signReturnData.hexdata)\n        console.log('ecHexSign', ecHexSign)\n        let params = {\n          signdata: ecHexSign,\n          method: this.signReturnData.method,\n          waitResp: this.signReturnData.waitResp || false,\n          from: this.signReturnData.from,\n          hexdata: this.signReturnData.hexdata,\n          refid: this.signReturnData.refid,\n          resp_refid: this.signReturnData.resp_refid\n        }\n        console.log('send_sign', params)\n        // 签名请求\n        sendSignData(params).then((res) => {\n          console.log('res', res)\n          if (res.status === 200 && res.data.ret_code >= 0) {\n            // 清除 badge \n            chrome.runtime.sendMessage({\n              type: 'SIGNJSONRETURN',\n              data: this.signJson\n            }, function (response) { })\n            // 向页面发送成功签名请求数据\n            this.sendMessageToContentScript({ msg: '同意了你的签名请求', type: 'SIGNDATARETURN', data: res.data, status: true }, (response) => {\n              console.log(response)\n            })\n            // 清除加载\n            Toast.clear()\n            // 跳转到钱包主页\n            this.$router.replace({\n              path: '/money-bag'\n            })\n          } else if (res.status === 200 && res.data.ret_code < 0) {\n            // 签名异常后\n            // 清除 badge \n            chrome.runtime.sendMessage({\n              type: 'SIGNJSONRETURN',\n              data: this.signJson\n            }, function (response) { })\n            // 向页面发送异常请求\n            this.sendMessageToContentScript({ msg: '你的签名请求异常', type: 'SIGNDATARETURN', status: false }, (response) => {\n              console.log(response)\n            })\n            // 提示异常信息\n            Toast.clear()\n            Toast(res.data.ret_message)\n          }\n        }).catch((err) => {\n          console.log(err)\n          Toast.clear()\n          // 向页面发送异常请求\n          this.sendMessageToContentScript({ msg: '你的签名请求失败', type: 'SIGNDATARETURN', status: false }, (response) => {\n            console.log(response)\n          })\n        })\n      }\n    },\n    getCurrentTabId (callback) {\n      chrome.tabs.query({ active: true, currentWindow: true }, function (tabs) {\n        if (callback) callback(tabs.length ? tabs[0].id : null);\n      })\n    },\n    sendMessageToContentScript (message, callback) {\n      this.getCurrentTabId((tabId) => {\n        chrome.tabs.sendMessage(tabId, message, function (response) {\n          if (callback) callback(response)\n        });\n      });\n    }\n  }\n}\n</script>\n\n<style lang=\"less\" scoped>\n.signature {\n  width: 100%;\n  height: 100%;\n  position: fixed;\n  padding: 20px;\n  text-align: center;\n  h2 {\n    font-size: 32px;\n    font-family: STHeitiTC-Light;\n    font-weight: 500;\n    color: rgba(51, 76, 169, 1);\n    line-height: 40px;\n    margin-top: 100px;\n  }\n  p {\n    font-size: 20px;\n    font-family: PingFangSC;\n    font-weight: 300;\n    color: rgba(0, 0, 0, 0.35);\n    line-height: 60px;\n  }\n  .button {\n    margin-top: 180px;\n    button {\n      outline: none;\n      border: none;\n      text-align: center;\n      font-size: 16px;\n      font-family: PingFangSC-Light;\n      font-weight: 500;\n      color: rgba(51, 76, 169, 1);\n      width: 138px;\n      height: 44px;\n      border-radius: 4px;\n      letter-spacing: 4px;\n      border: 1px solid rgba(51, 76, 169, 1);\n      &.refuse {\n        background: none;\n      }\n      &.agree {\n        margin-left: 20px;\n        background: rgba(51, 76, 169, 1);\n        box-shadow: 0px 6px 20px 0px rgba(8, 21, 67, 0.26);\n        color: #fff;\n      }\n    }\n  }\n}\n</style>"],"sourceRoot":"src/views/signature"}]}