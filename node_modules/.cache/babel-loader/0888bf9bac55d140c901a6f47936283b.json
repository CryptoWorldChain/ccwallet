{"remainingRequest":"/Users/will/Documents/finchain/plugin/extension/node_modules/thread-loader/dist/cjs.js!/Users/will/Documents/finchain/plugin/extension/node_modules/babel-loader/lib/index.js!/Users/will/Documents/finchain/plugin/extension/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/will/Documents/finchain/plugin/extension/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/will/Documents/finchain/plugin/extension/src/views/money/MoneyBag.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/will/Documents/finchain/plugin/extension/src/views/money/MoneyBag.vue","mtime":1577262464776},{"path":"/Users/will/Documents/finchain/plugin/extension/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/will/Documents/finchain/plugin/extension/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/will/Documents/finchain/plugin/extension/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/will/Documents/finchain/plugin/extension/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/will/Documents/finchain/plugin/extension/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["\"use strict\";\n\nvar _interopRequireDefault = require(\"/Users/will/Documents/finchain/plugin/extension/node_modules/@babel/runtime-corejs2/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nrequire(\"core-js/modules/es6.regexp.replace\");\n\nrequire(\"core-js/modules/es6.array.find-index\");\n\nrequire(\"regenerator-runtime/runtime\");\n\nvar _asyncToGenerator2 = _interopRequireDefault(require(\"/Users/will/Documents/finchain/plugin/extension/node_modules/@babel/runtime-corejs2/helpers/esm/asyncToGenerator\"));\n\nvar _vant = require(\"vant\");\n\nvar _create = require(\"@/api/create\");\n\nvar _sign = require(\"@/api/sign\");\n\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nvar _default = {\n  data: function data() {\n    return {\n      user: {\n        uesrName: '******',\n        newUserName: '',\n        userAddress: '',\n        userAddressPwd: '*******************',\n        aaaMoney: '0.00',\n        hexPrikey: ''\n      },\n      aaaMoney: {\n        aaa: '0.00',\n        rmb: '0.00'\n      },\n      usdtMoney: {\n        aaa: '0.00',\n        rmb: '0.00'\n      },\n      moreShow: false,\n      exitShow: false,\n      modifyShow: false,\n      actions: [{\n        name: '更改用户名',\n        type: 'changeUserName'\n      }, {\n        name: '退出当前身份',\n        type: 'exit',\n        className: 'warning'\n      }],\n      message: '即将溢出身份及所有导入的钱包，请确保所有钱包已备份。'\n    };\n  },\n  created: function () {\n    var _created = (0, _asyncToGenerator2.default)(\n    /*#__PURE__*/\n    regeneratorRuntime.mark(function _callee() {\n      var _this = this;\n\n      var uesrName, keypair, str;\n      return regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              // TODO: 插件使用\n              uesrName = '';\n              keypair = '';\n              _context.next = 4;\n              return this.$unit.getStorage('username').then(function (v) {\n                uesrName = v || '';\n              });\n\n            case 4:\n              _context.next = 6;\n              return this.$unit.getStorage('keypair').then(function (v) {\n                keypair = JSON.stringify(v);\n              });\n\n            case 6:\n              // await this.$unit.getStorage('balance').then((v) => {\n              // \tbalance = JSON.stringify(v)\n              // })\n              // console.log(balance)\n              // FIXME: 本地使用\n              // let uesrName = window.localStorage.getItem('username')\n              // let keypair = window.localStorage.getItem('keypair')\n              this.user.userAddress = JSON.parse(keypair).hexAddress;\n              this.$cwv.rpc.getBalance(this.user.userAddress).then(function (res) {\n                if (res && res.account) {\n                  chrome.storage.local.set({\n                    nonce: res.account.value.nonce\n                  });\n                }\n              });\n              this.user.hexPrikey = JSON.parse(keypair).hexPrikey;\n              str = this.user.userAddress;\n              this.user.userAddressPwd = str.substring(0, 13) + '****' + str.substring(str.length - 13);\n              this.user.uesrName = uesrName; // 获取余额\n\n              _context.next = 14;\n              return (0, _create.getBalance)({\n                address: this.user.userAddress\n              }).then(function (res) {\n                if (res.status === 200 && res.data.retCode < 0) {\n                  _this.user.aaaMoney = 0;\n                }\n\n                if (res.status === 200 && res.data.retCode >= 0) {\n                  if (res.data.account.value.hasOwnProperty(\"tokens\")) {\n                    var index = res.data.account.value.tokens.findIndex(function (v) {\n                      return v.token === \"AAA\";\n                    });\n\n                    if (index >= 0) {\n                      var balance = (res.data.account.value.tokens[index].balance / 1000000000000000000).toFixed(0);\n                      _this.user.aaaMoney = balance;\n                      _this.aaaMoney = {\n                        aaa: balance,\n                        rmb: balance\n                      };\n                    }\n                  } else {\n                    _this.user.aaaMoney = 0;\n                  }\n                }\n\n                _this.sendMessageToContentScript({\n                  msg: 'confirm -> content; 传递钱包地址',\n                  type: 'SENDMONEYADDRESS',\n                  data: {\n                    moneyAddress: str,\n                    balance: _this.user.aaaMoney\n                  }\n                }, function (response) {\n                  console.log(response);\n                });\n              }).catch(function (err) {\n                console.log(err);\n              });\n\n            case 14:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, this);\n    }));\n\n    function created() {\n      return _created.apply(this, arguments);\n    }\n\n    return created;\n  }(),\n  mounted: function mounted() {\n    var _this2 = this;\n\n    document.onkeyup = function (e) {\n      var key = window.event.keyCode;\n\n      if (key === 13) {\n        _this2.userModify();\n      }\n    };\n  },\n  methods: {\n    // 浏览器中打开\n    openInBrowser: function openInBrowser() {\n      window.open(chrome.extension.getURL('/index.html'));\n    },\n    inputName: function inputName(e) {},\n    // 更多按钮\n    more: function more() {\n      this.moreShow = true;\n    },\n    // 拷贝按钮\n    copy: function copy() {\n      var clipboard = new this.$clipboard('.user-address');\n      clipboard.on('success', function (e) {\n        (0, _vant.Toast)('复制成功'); // 释放内存\n\n        clipboard.destroy();\n      });\n      clipboard.on('error', function (e) {\n        // 不支持复制\n        (0, _vant.Toast)('该浏览器不支持自动复制'); // 释放内存\n\n        clipboard.destroy();\n      });\n      var timer = setInterval(function () {\n        clearInterval(timer);\n\n        _vant.Toast.clear();\n      }, 800);\n    },\n    // 退出 & 更改用户名\n    onSelect: function onSelect(val) {\n      this.moreShow = false;\n\n      if (val.type === \"changeUserName\") {\n        this.user.newUserName = this.user.uesrName;\n        this.modifyShow = true;\n      }\n\n      if (val.type === \"exit\") {\n        this.exitShow = true;\n      }\n    },\n    // 更改用户名确定\n    userModify: function () {\n      var _userModify = (0, _asyncToGenerator2.default)(\n      /*#__PURE__*/\n      regeneratorRuntime.mark(function _callee2() {\n        var _this3 = this;\n\n        var params, recoverToast;\n        return regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                if (!this.user.newUserName) {\n                  _context2.next = 11;\n                  break;\n                }\n\n                params = {\n                  method: 'BrokerInfo',\n                  from: this.user.userAddress,\n                  jsbody: JSON.stringify({\n                    uinfo: {\n                      alias: this.user.newUserName\n                    }\n                  }),\n                  refid: new Date() - 0\n                };\n\n                if (!(this.user.newUserName.length >= 20)) {\n                  _context2.next = 5;\n                  break;\n                }\n\n                (0, _vant.Toast)('您输入的用户名过长');\n                return _context2.abrupt(\"return\");\n\n              case 5:\n                recoverToast = _vant.Toast.loading({\n                  duration: 0,\n                  mask: true,\n                  message: '更改中...'\n                });\n                this.user.uesrName = this.user.newUserName;\n                chrome.storage.local.set({\n                  username: this.user.newUserName\n                }, function () {\n                  recoverToast.clear();\n                });\n                this.modifyShow = false;\n                return _context2.abrupt(\"return\");\n\n              case 11:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, this);\n      }));\n\n      function userModify() {\n        return _userModify.apply(this, arguments);\n      }\n\n      return userModify;\n    }(),\n    // 确定退出\n    confirm: function confirm() {\n      // this.$router.replace({ name: 'login' })\n      this.$router.replace({\n        name: 'welcome'\n      });\n      chrome.storage.local.remove(['state', 'keypair', 'keystore']);\n      this.sendMessageToContentScript({\n        msg: '退出当前钱包地址',\n        type: 'EXITMONEYADDRESS',\n        data: {}\n      }, function (response) {\n        console.log(response);\n      }); // TODO: 插件使用\n      // chrome.storage.local.set({ state: 'HAVE' }, function () { })\n      // window.localStorage.setItem('open', true)\n      // chrome.extension.getBackgroundPage().GlobalState = 'OPEN'\n      // FIXME: 本地使用\n      // window.localStorage.setItem('state', 'HAVE')\n    },\n    // 发送信息给content_script\n    getCurrentTabId: function getCurrentTabId(callback) {\n      chrome.tabs.query({\n        active: true,\n        currentWindow: true\n      }, function (tabs) {\n        if (callback) callback(tabs.length ? tabs[0].id : null);\n      });\n    },\n    sendMessageToContentScript: function sendMessageToContentScript(message, callback) {\n      this.getCurrentTabId(function (tabId) {\n        chrome.tabs.sendMessage(tabId, message, function (response) {\n          if (callback) callback(response);\n        });\n      });\n    }\n  }\n};\nexports.default = _default;",{"version":3,"sources":["MoneyBag.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n  <div class=\"money-bag\">\n    <h2 class=\"header\" @click=\"openInBrowser\">钱包</h2>\n    <div class=\"user\">\n      <div class=\"user-info\">\n        <div class=\"left\">\n          <p class=\"ellipsis user-name\">{{user.uesrName}}</p>\n          <p class=\"user-address\" :data-clipboard-text=\"user.userAddress\" @click=\"copy\">{{user.userAddressPwd}} <span class=\"copy\"></span></p>\n        </div>\n        <div class=\"right\">\n          <van-icon name=\"ellipsis\" @click=\"more\" />\n        </div>\n      </div>\n      <div class=\"user-money\">\n        <h3 class=\"aaa\">{{user.aaaMoney}}</h3>\n      </div>\n    </div>\n    <!-- <ul class=\"bag-list\">\n      <li class=\"aaa\">\n        <div class=\"aaa-left\">\n          <i class=\"aaa-left-logo\"></i>\n          <span class=\"aaa-left-text\">CWV</span>\n        </div>\n        <div class=\"aaa-right\">\n          <div class=\"aaa-right-money\">\n            <h3>{{aaaMoney.aaa}}</h3>\n            <h4>￥ {{aaaMoney.rmb}}</h4>\n          </div>\n          <router-link :to=\"{name: 'money-aaa'}\" class=\"aaa-right-link\"></router-link>\n        </div>\n      </li>\n    </ul> -->\n    <!-- 上拉选择 -->\n    <div>\n      <van-action-sheet v-model=\"moreShow\" :actions=\"actions\" cancel-text=\"取消\" @select=\"onSelect\" />\n    </div>\n    <!-- 退出弹框 -->\n    <div class=\"mask\">\n      <van-dialog v-model=\"exitShow\" title=\"退出当前身份\" confirm-button-text=\"确定\" :message=\"message\" show-cancel-button @confirm=\"confirm\">\n      </van-dialog>\n    </div>\n    <!-- 更改用户名弹框 -->\n    <div class=\"mask mask2\">\n      <van-dialog v-model=\"modifyShow\" title=\"更改用户名\" confirm-button-text=\"确定\" show-cancel-button @confirm=\"userModify\">\n        <van-field v-model=\"user.newUserName\" placeholder=\"请输入新的用户名\" \n          autofocus=\"true\"\n          @input=\"inputName($event)\"\n        />\n      </van-dialog>\n    </div>\n  </div>\n</template>\n\n<script>\nimport { Toast } from 'vant'\nimport { userLogin, getBalance } from '@/api/create'\nimport { sendSignData } from '@/api/sign'\nexport default {\n  data () {\n    return {\n      user: {\n        uesrName: '******',\n        newUserName: '',\n        userAddress: '',\n        userAddressPwd: '*******************',\n        aaaMoney: '0.00',\n        hexPrikey: ''\n      },\n      aaaMoney: {\n        aaa: '0.00',\n        rmb: '0.00'\n      },\n      usdtMoney: {\n        aaa: '0.00',\n        rmb: '0.00'\n      },\n      moreShow: false,\n      exitShow: false,\n      modifyShow: false,\n      actions: [\n        { name: '更改用户名', type: 'changeUserName' },\n        { name: '退出当前身份', type: 'exit', className: 'warning' }\n      ],\n      message: '即将溢出身份及所有导入的钱包，请确保所有钱包已备份。',\n    }\n  },\n  async created () {\n    // TODO: 插件使用\n    let uesrName = ''\n    let keypair = ''\n    await this.$unit.getStorage('username').then((v) => {\n      uesrName = v || ''\n    })\n    await this.$unit.getStorage('keypair').then((v) => {\n      keypair = JSON.stringify(v)\n    })\n    // await this.$unit.getStorage('balance').then((v) => {\n    // \tbalance = JSON.stringify(v)\n    // })\n    // console.log(balance)\n    // FIXME: 本地使用\n    // let uesrName = window.localStorage.getItem('username')\n    // let keypair = window.localStorage.getItem('keypair')\n    this.user.userAddress = JSON.parse(keypair).hexAddress\n    this.$cwv.rpc.getBalance(this.user.userAddress).then(res=>{\n      if (res && res.account) {\n        chrome.storage.local.set({\n          nonce: res.account.value.nonce\n        })\n      }\n    })\n    this.user.hexPrikey = JSON.parse(keypair).hexPrikey\n    let str = this.user.userAddress\n    this.user.userAddressPwd = str.substring(0, 13) + '****' + str.substring(str.length - 13)\n    this.user.uesrName = uesrName\n\n    // 获取余额\n    await getBalance({ address: this.user.userAddress }).then((res) => {\n      if (res.status === 200 && res.data.retCode < 0) {\n        this.user.aaaMoney = 0\n      }\n      if (res.status === 200 && res.data.retCode >= 0) {\n        if (res.data.account.value.hasOwnProperty(\"tokens\")) {\n          let index = res.data.account.value.tokens.findIndex(v => {\n            return v.token === \"AAA\"\n          })\n          if (index >= 0) {\n            let balance = (res.data.account.value.tokens[index].balance / 1000000000000000000).toFixed(0)\n            this.user.aaaMoney = balance\n            this.aaaMoney = {\n              aaa: balance,\n              rmb: balance\n            }\n          }\n        } else {\n          this.user.aaaMoney = 0\n        }\n      }\n      this.sendMessageToContentScript({ msg: 'confirm -> content; 传递钱包地址', type: 'SENDMONEYADDRESS', data: { moneyAddress: str, balance: this.user.aaaMoney } }, (response) => {\n        console.log(response)\n      })\n    }).catch((err) => {\n      console.log(err)\n    })\n    // this.user.aaaMoney = balance.replace(/\\\"/g, \"\")\n  },\n  mounted() {\n    document.onkeyup = (e) => {\n      let key = window.event.keyCode\n      if (key === 13) {\n        this.userModify()\n      }\n    }\n  },\n  methods: {\n    // 浏览器中打开\n    openInBrowser() {\n      window.open(chrome.extension.getURL('/index.html'));\n    },\n    inputName(e) {\n      \n    },\n    // 更多按钮\n    more () {\n      this.moreShow = true\n    },\n    // 拷贝按钮\n    copy () {\n      let clipboard = new this.$clipboard('.user-address')\n      clipboard.on('success', e => {\n        Toast('复制成功')\n        // 释放内存\n        clipboard.destroy()\n      })\n      clipboard.on('error', e => {\n        // 不支持复制\n        Toast('该浏览器不支持自动复制')\n        // 释放内存\n        clipboard.destroy()\n      })\n      const timer = setInterval(() => {\n        clearInterval(timer)\n        Toast.clear()\n      }, 800)\n    },\n    // 退出 & 更改用户名\n    onSelect (val) {\n      this.moreShow = false\n      if (val.type === \"changeUserName\") {\n        this.user.newUserName = this.user.uesrName\n        this.modifyShow = true\n      }\n      if (val.type === \"exit\") {\n        this.exitShow = true\n      }\n    },\n    // 更改用户名确定\n    async userModify () {\n      if (this.user.newUserName) {\n        let params = {\n          method: 'BrokerInfo',\n          from: this.user.userAddress,\n          jsbody: JSON.stringify({\n            uinfo: {\n              alias: this.user.newUserName\n            }\n          }),\n          refid: new Date() - 0\n        }\n        if (this.user.newUserName.length >= 20) {\n          Toast('您输入的用户名过长')\n          return\n        }\n        const recoverToast = Toast.loading({\n          duration: 0,\n          mask: true,\n          message: '更改中...'\n        })\n        this.user.uesrName = this.user.newUserName\n        chrome.storage.local.set({ username: this.user.newUserName }, function () { \n          recoverToast.clear()\n        })\n        this.modifyShow = false\n        return\n        userLogin(params).then((res) => {\n          if (res.status === 200 && res.data.ret_code === 0) {\n            // 注册返回data 进行签名\n            let ecHexSign = this.$cwv2.ecHexSign(this.user.hexPrikey, res.data.hexdata)\n            let params2 = {\n              signdata: ecHexSign,\n              method: res.data.method,\n              waitResp: true,\n              from: res.data.from,\n              hexdata: res.data.hexdata,\n              refid: res.data.refid,\n              resp_refid: res.data.resp_refid\n            }\n            sendSignData(params2).then((res) => {\n              console.log('res', res)\n              if (res.status === 200 && res.data.ret_code >= 0) {\n                recoverToast.clear()\n                this.user.uesrName = this.user.newUserName\n                // TODO: 插件使用\n                chrome.storage.local.set({ username: this.user.newUserName }, function () { })\n                this.modifyShow = false\n              } else if (res.status === 200 && res.data.ret_code < 0) {\n                Toast({\n                  duration: 1000,\n                  message: res.data.ret_message\n                })\n              }\n            }).catch((err) => {\n              console.log(err)\n              Toast.clear()\n            })\n          } else {\n            recoverToast.clear()\n            Toast({\n              duration: 1000,\n              message: res.data.ret_message\n            })\n          }\n        }).catch((err) => {\n          recoverToast.clear()\n          Toast({\n            duration: 1000,\n            message: '用户名更改失败！'\n          })\n        })\n      }\n    },\n    // 确定退出\n    confirm () {\n      // this.$router.replace({ name: 'login' })\n      this.$router.replace({ name: 'welcome' })\n      chrome.storage.local.remove(['state', 'keypair', 'keystore'])\n      this.sendMessageToContentScript({ msg: '退出当前钱包地址', type: 'EXITMONEYADDRESS', data: {} }, (response) => {\n        console.log(response)\n      })\n\n      // TODO: 插件使用\n      // chrome.storage.local.set({ state: 'HAVE' }, function () { })\n      // window.localStorage.setItem('open', true)\n      // chrome.extension.getBackgroundPage().GlobalState = 'OPEN'\n\n\n\n      // FIXME: 本地使用\n      // window.localStorage.setItem('state', 'HAVE')\n\n    },\n    // 发送信息给content_script\n    getCurrentTabId (callback) {\n      chrome.tabs.query({ active: true, currentWindow: true }, function (tabs) {\n        if (callback) callback(tabs.length ? tabs[0].id : null);\n      })\n    },\n    sendMessageToContentScript (message, callback) {\n      this.getCurrentTabId((tabId) => {\n        chrome.tabs.sendMessage(tabId, message, function (response) {\n          if (callback) callback(response)\n        })\n      })\n    }\n  }\n}\n</script>\n\n<style lang=\"less\" scoped>\n.money-bag {\n  padding: 20px;\n  /deep/ h2 {\n    text-align: center;\n    font-size: 16px;\n    margin-bottom: 20px;\n    font-family: PingFangSC;\n    font-weight: 400;\n    color: rgba(0, 0, 0, 0.85);\n  }\n  .user {\n    height: 142px;\n    padding: 18px;\n    background: url('../../assets/money-bg.png') no-repeat;\n    background-size: 100%;\n    .user-info {\n      .left {\n        display: inline-block;\n        width: 80%;\n        .user-name {\n          text-align: left;\n          font-size: 16px;\n          font-family: PingFangSC-Regular;\n          font-weight: 400;\n          color: rgba(255, 255, 255, 1);\n          line-height: 22px;\n        }\n        .user-address {\n          font-size: 12px;\n          font-family: SourceHanSansCN-Regular;\n          font-weight: 400;\n          color: rgba(255, 255, 255, 0.85);\n          line-height: 18px;\n          span {\n            display: inline-block;\n            width: 10px;\n            height: 10px;\n            margin: 4px 0 0 2px;\n            background: url('../../assets/copy1.png') no-repeat;\n            background-size: 100%;\n          }\n        }\n      }\n      .right {\n        display: inline-block;\n        width: 20%;\n        text-align: right;\n        color: #fff;\n        font-size: 28px;\n        vertical-align: top;\n      }\n    }\n    .user-money {\n      text-align: right;\n      margin-top: 26px;\n      .aaa {\n        font-size: 36px;\n        font-family: PingFangSC-Medium;\n        font-weight: 500;\n        color: #fff;\n        line-height: 40px;\n        overflow: hidden;\n        white-space: nowrap;\n        text-overflow: ellipsis;\n      }\n    }\n  }\n  .bag-list {\n    .aaa,\n    .usdt {\n      padding: 12px 0;\n      margin-top: 12px;\n      border-bottom: 1px solid rgba(0, 0, 0, 0.04);\n      &-left {\n        display: inline-block;\n        width: 50%;\n        text-align: left;\n        vertical-align: middle;\n        &-logo {\n          display: inline-block;\n          width: 24px;\n          height: 24px;\n          background: url('../../assets/money-aaa.png') no-repeat;\n          background-size: 100%;\n          vertical-align: middle;\n        }\n        &-text {\n          font-size: 16px;\n          font-family: PingFangSC;\n          font-weight: 500;\n          color: rgba(0, 0, 0, 0.85);\n          vertical-align: middle;\n          margin-left: 8px;\n        }\n      }\n      &-right {\n        display: inline-block;\n        width: 50%;\n        text-align: right;\n        vertical-align: middle;\n        &-money {\n          display: inline-block;\n          vertical-align: middle;\n          h3 {\n            font-size: 16px;\n            font-family: PingFangSC;\n            font-weight: 500;\n            color: rgba(0, 0, 0, 0.85);\n          }\n          h4 {\n            font-size: 14px;\n            font-family: PingFangSC;\n            font-weight: 400;\n            color: rgba(0, 0, 0, 0.35);\n          }\n        }\n        &-link {\n          width: 8px;\n          height: 12px;\n          margin-left: 10px;\n          display: inline-block;\n          background: url('../../assets/right.png') no-repeat;\n          background-size: 100% 100%;\n          vertical-align: middle;\n        }\n      }\n    }\n    .usdt-left-logo {\n      background: url('../../assets/money-usdt.png') no-repeat;\n      background-size: 100%;\n    }\n    .usdt {\n      border-bottom: none;\n    }\n  }\n  .warning {\n    color: #f6222e;\n  }\n  .mask {\n    /deep/ .van-dialog {\n      width: 296px;\n      height: 180px;\n      background: rgba(255, 255, 255, 1);\n      box-shadow: 0px 2px 11px 0px rgba(0, 0, 0, 0.1);\n      border-radius: 4px;\n      padding: 18px;\n      .van-dialog__header {\n        font-size: 20px;\n        font-family: PingFangSC-Medium;\n        font-weight: 500;\n        color: rgba(0, 0, 0, 1);\n        line-height: 28px;\n        padding-top: 8px;\n      }\n      .van-dialog__footer--buttons {\n        display: block;\n        text-align: right;\n      }\n      .van-hairline--top::after {\n        border-top-width: 0 !important;\n      }\n      .van-dialog__message--has-title {\n        padding: 0;\n      }\n      .van-dialog__message {\n        text-align: left;\n        font-size: 14px;\n        font-family: PingFangSC-Regular;\n        font-weight: 400;\n        color: rgba(0, 0, 0, 0.65);\n        line-height: 24px;\n        margin-top: 14px;\n      }\n      .van-button {\n        margin-top: 14px;\n        width: 70px;\n        height: 32px;\n        line-height: 32px;\n        background: rgba(246, 34, 46, 0.1);\n        border-radius: 4px;\n        font-size: 14px;\n        font-family: PingFangSC-Regular;\n        font-weight: 400;\n        color: rgba(246, 34, 46, 1);\n        &::before {\n        }\n      }\n      .van-dialog__cancel {\n        background: none;\n        color: rgba(0, 0, 0, 0.54);\n      }\n    }\n  }\n  .mask2 {\n    /deep/ .van-dialog {\n      .van-button {\n        background: rgba(40, 60, 135, 0.1) !important;\n        color: rgba(81, 111, 234, 1) !important;\n      }\n      .van-dialog__cancel {\n        background: none !important;\n        color: rgba(0, 0, 0, 0.54) !important;\n      }\n    }\n    /deep/ .van-field {\n      padding: 14px 0;\n      .van-field__control {\n        width: 299px;\n        height: 38px;\n        padding: 0 6px;\n        background: rgba(0, 0, 0, 0.02);\n        border-radius: 4px;\n        border: 1px solid rgba(0, 0, 0, 0.09);\n      }\n    }\n  }\n}\n</style>"],"sourceRoot":"src/views/money"}]}