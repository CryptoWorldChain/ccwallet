{"remainingRequest":"/Users/will/Documents/finchain/plugin/extension/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/will/Documents/finchain/plugin/extension/src/views/signature/Signature.vue?vue&type=style&index=0&id=7da0713c&lang=less&scoped=true&","dependencies":[{"path":"/Users/will/Documents/finchain/plugin/extension/src/views/signature/Signature.vue","mtime":1575252864237},{"path":"/Users/will/Documents/finchain/plugin/extension/node_modules/css-loader/index.js","mtime":499162500000},{"path":"/Users/will/Documents/finchain/plugin/extension/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":499162500000},{"path":"/Users/will/Documents/finchain/plugin/extension/node_modules/postcss-loader/src/index.js","mtime":499162500000},{"path":"/Users/will/Documents/finchain/plugin/extension/node_modules/less-loader/dist/cjs.js","mtime":1574850612789},{"path":"/Users/will/Documents/finchain/plugin/extension/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/will/Documents/finchain/plugin/extension/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n.signature {\n  width: 100%;\n  height: 100%;\n  position: fixed;\n  padding: 20px;\n  text-align: center;\n  h2 {\n    font-size: 32px;\n    font-family: STHeitiTC-Light;\n    font-weight: 500;\n    color: rgba(51, 76, 169, 1);\n    line-height: 40px;\n    margin-top: 100px;\n  }\n  p {\n    font-size: 20px;\n    font-family: PingFangSC;\n    font-weight: 300;\n    color: rgba(0, 0, 0, 0.55);\n    line-height: 60px;\n  }\n  .button {\n    margin-top: 180px;\n    button {\n      outline: none;\n      border: none;\n      text-align: center;\n      font-size: 16px;\n      font-family: PingFangSC-Light;\n      font-weight: 500;\n      color: rgba(51, 76, 169, 1);\n      width: 138px;\n      height: 44px;\n      border-radius: 4px;\n      letter-spacing: 4px;\n      border: 1px solid rgba(51, 76, 169, 1);\n      &.refuse {\n        background: none;\n      }\n      &.agree {\n        margin-left: 20px;\n        background: rgba(51, 76, 169, 1);\n        box-shadow: 0px 6px 20px 0px rgba(8, 21, 67, 0.26);\n        color: #fff;\n      }\n    }\n  }\n}\n",{"version":3,"sources":["Signature.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAqIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"Signature.vue","sourceRoot":"src/views/signature","sourcesContent":["<template>\n  <div class=\"signature\">\n    <h2></h2>\n    <p>请求签名</p>\n    <div class=\"button\">\n      <button class=\"refuse\" @click=\"refuse\">取消</button>\n      <button class=\"agree\" @click=\"agree\">同意</button>\n    </div>\n  </div>\n</template>\n\n<script>\nimport { getSignData, sendSignData } from '@/api/sign'\nimport { Toast } from 'vant'\nexport default {\n  data () {\n    return {\n      // signJSONArr: []\n      signJson: '',\n      signReturnData: '',\n    }\n  },\n  async created () {\n    let background = chrome.extension.getBackgroundPage()\n    this.signJson = background.signJson()\n    this.signReturnData = JSON.parse(this.signJson)\n  },\n  computed () { },\n  methods: {\n    // 取消\n    refuse () {\n      // 清除 badge \n      chrome.runtime.sendMessage({\n        type: 'SIGNJSONRETURN',\n        data: this.signJson\n      }, function (response) { })\n      // 跳转到钱包主页\n      this.$router.replace({\n        path: '/money-bag'\n      })\n      // TODO: 向页面发送取消请求\n      this.sendMessageToContentScript({ msg: '取消你的签名请求', type: 'SIGNDATARETURN', status: false }, (response) => {\n        console.log(response)\n      })\n    },\n    async agree () {\n      if (this.signReturnData) {\n        Toast.loading({\n          duration: 0,\n          mask: true,\n          message: '签名中...'\n        })\n        // 获取 keypair\n        let keypair = ''\n        await this.$unit.getStorage('keypair').then((v) => {\n          keypair = JSON.stringify(v)\n        })\n        console.log('keypair', JSON.parse(keypair).hexPrikey)\n        console.log('this.signHexData', this.signReturnData)\n        // 通过私钥和第一次请求返回的hashData进行数据签名\n        let ecHexSign = this.$cwv2.ecHexSign(JSON.parse(keypair).hexPrikey, this.signReturnData.hexdata)\n        console.log('ecHexSign', ecHexSign)\n        let params = {\n          signdata: ecHexSign,\n          method: this.signReturnData.method,\n          waitResp: this.signReturnData.waitResp || false,\n          from: this.signReturnData.from,\n          hexdata: this.signReturnData.hexdata,\n          refid: this.signReturnData.refid,\n          resp_refid: this.signReturnData.resp_refid\n        }\n        console.log('send_sign', params)\n        // 签名请求\n        sendSignData(params).then((res) => {\n          console.log('res', res)\n          if (res.status === 200 && res.data.ret_code >= 0) {\n            // 清除 badge \n            chrome.runtime.sendMessage({\n              type: 'SIGNJSONRETURN',\n              data: this.signJson\n            }, function (response) { })\n            // 向页面发送成功签名请求数据\n            this.sendMessageToContentScript({ msg: '同意了你的签名请求', type: 'SIGNDATARETURN', data: res.data, status: true }, (response) => {\n              console.log(response)\n            })\n            // 清除加载\n            Toast.clear()\n            // 跳转到钱包主页\n            this.$router.replace({\n              path: '/money-bag'\n            })\n          } else if (res.status === 200 && res.data.ret_code < 0) {\n            // 签名异常后\n            // 清除 badge \n            chrome.runtime.sendMessage({\n              type: 'SIGNJSONRETURN',\n              data: this.signJson\n            }, function (response) { })\n            // 向页面发送异常请求\n            this.sendMessageToContentScript({ msg: '你的签名请求异常', type: 'SIGNDATARETURN', status: false }, (response) => {\n              console.log(response)\n            })\n            // 提示异常信息\n            Toast.clear()\n            Toast(res.data.ret_message)\n          }\n        }).catch((err) => {\n          console.log(err)\n          Toast.clear()\n          // 向页面发送异常请求\n          this.sendMessageToContentScript({ msg: '你的签名请求失败', type: 'SIGNDATARETURN', status: false }, (response) => {\n            console.log(response)\n          })\n        })\n      }\n    },\n    getCurrentTabId (callback) {\n      chrome.tabs.query({ active: true, currentWindow: true }, function (tabs) {\n        if (callback) callback(tabs.length ? tabs[0].id : null);\n      })\n    },\n    sendMessageToContentScript (message, callback) {\n      this.getCurrentTabId((tabId) => {\n        chrome.tabs.sendMessage(tabId, message, function (response) {\n          if (callback) callback(response)\n        });\n      });\n    }\n  }\n}\n</script>\n\n<style lang=\"less\" scoped>\n.signature {\n  width: 100%;\n  height: 100%;\n  position: fixed;\n  padding: 20px;\n  text-align: center;\n  h2 {\n    font-size: 32px;\n    font-family: STHeitiTC-Light;\n    font-weight: 500;\n    color: rgba(51, 76, 169, 1);\n    line-height: 40px;\n    margin-top: 100px;\n  }\n  p {\n    font-size: 20px;\n    font-family: PingFangSC;\n    font-weight: 300;\n    color: rgba(0, 0, 0, 0.55);\n    line-height: 60px;\n  }\n  .button {\n    margin-top: 180px;\n    button {\n      outline: none;\n      border: none;\n      text-align: center;\n      font-size: 16px;\n      font-family: PingFangSC-Light;\n      font-weight: 500;\n      color: rgba(51, 76, 169, 1);\n      width: 138px;\n      height: 44px;\n      border-radius: 4px;\n      letter-spacing: 4px;\n      border: 1px solid rgba(51, 76, 169, 1);\n      &.refuse {\n        background: none;\n      }\n      &.agree {\n        margin-left: 20px;\n        background: rgba(51, 76, 169, 1);\n        box-shadow: 0px 6px 20px 0px rgba(8, 21, 67, 0.26);\n        color: #fff;\n      }\n    }\n  }\n}\n</style>"]}]}