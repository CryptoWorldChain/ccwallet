{"remainingRequest":"/Users/will/Documents/finchain/2020/extension/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/will/Documents/finchain/2020/extension/src/views/recover/Recover.vue?vue&type=style&index=0&id=3d9fa7ef&lang=less&scoped=true&","dependencies":[{"path":"/Users/will/Documents/finchain/2020/extension/src/views/recover/Recover.vue","mtime":1575013208681},{"path":"/Users/will/Documents/finchain/2020/extension/node_modules/css-loader/index.js","mtime":499162500000},{"path":"/Users/will/Documents/finchain/2020/extension/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":499162500000},{"path":"/Users/will/Documents/finchain/2020/extension/node_modules/postcss-loader/src/index.js","mtime":499162500000},{"path":"/Users/will/Documents/finchain/2020/extension/node_modules/less-loader/dist/cjs.js","mtime":1574850612789},{"path":"/Users/will/Documents/finchain/2020/extension/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/will/Documents/finchain/2020/extension/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n.recover {\n  width: 100%;\n  height: 100%;\n  padding: 20px;\n  .header {\n    font-size: 16px;\n    .van-icon-arrow-left {\n      cursor: pointer;\n      color: #516fea;\n    }\n  }\n  .title {\n    width: 100%;\n    margin-top: 20px;\n    text-align: center;\n    h2 {\n      font-size: 18px;\n      font-family: PingFangSC-Medium;\n      font-weight: 500;\n      color: rgba(0, 0, 0, 0.85);\n      line-height: 24px;\n    }\n    p {\n      font-size: 14px;\n      margin-top: 6px;\n      font-family: PingFangSC-Light;\n      font-weight: 300;\n      color: rgba(0, 0, 0, 0.65);\n      line-height: 20px;\n    }\n  }\n  .textarea-error-msg {\n    height: 16px;\n    margin-top: 10px;\n    text-align: center;\n    font-size: 12px;\n    font-family: PingFangSC-Regular;\n    font-weight: 400;\n    color: rgba(246, 34, 46, 1);\n    line-height: 16px;\n  }\n  .mnemonic {\n    width: 100%;\n    height: 127px;\n    margin-top: 4px;\n    background: rgba(0, 0, 0, 0.04);\n    border-radius: 4px;\n    border: none;\n    font-size: 14px;\n    font-family: PingFangSC-Light;\n    font-weight: 300;\n    color: rgba(0, 0, 0, 0.85);\n    line-height: 20px;\n    padding: 10px;\n    resize: none;\n    &.error {\n      border: 1px solid rgba(246, 34, 46, 1);\n    }\n  }\n  .from {\n    margin-top: 20px;\n    &-title {\n      font-size: 14px;\n      text-align: left;\n      font-family: PingFangSC-Regular;\n      font-weight: 400;\n      color: rgba(0, 0, 0, 0.85);\n      line-height: 20px;\n    }\n    &-item {\n      margin-top: 24px;\n      height: 34px;\n      position: relative;\n      &:last-child {\n        margin-bottom: 24px;\n      }\n      input {\n        font-size: 14px;\n        height: 100%;\n        font-family: PingFangSC-Light;\n        font-weight: 400;\n        color: rgba(0, 0, 0, 0.85);\n        line-height: 20px;\n        padding: 0;\n        border-bottom: 1px solid rgba(0, 0, 0, 0.12);\n      }\n      input.error {\n        border-color: rgba(246, 34, 46, 1);\n      }\n      .error-msg {\n        text-align: left;\n        font-size: 12px;\n        font-family: PingFangSC-Regular;\n        font-weight: 400;\n        color: rgba(246, 34, 46, 1);\n        line-height: 18px;\n      }\n    }\n    .first-item {\n      margin-top: 10px;\n    }\n  }\n  .button {\n    text-align: center;\n    margin-top: 35px;\n    width: 100%;\n    .btn {\n      width: 283px;\n      height: 48px;\n      background: rgba(51, 76, 169, 1);\n      border-radius: 4px;\n      border: 1px solid rgba(51, 76, 169, 1);\n      font-size: 13px;\n      font-family: PingFangSC-Medium;\n      font-weight: 500;\n      color: rgba(255, 255, 255, 1);\n    }\n    .btn-disabled {\n      background: rgba(174, 184, 221, 1);\n      color: rgba(255, 255, 255, 1);\n      border: 1px solid rgba(174, 184, 221, 1);\n    }\n  }\n}\n",{"version":3,"sources":["Recover.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAkUA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"Recover.vue","sourceRoot":"src/views/recover","sourcesContent":["<template>\n  <div class=\"recover\">\n    <div class=\"header\">\n      <van-icon @click=\"back\" name=\"arrow-left\" />\n    </div>\n    <div class=\"title\">\n      <h2>恢复身份</h2>\n      <p>使用助记词导入的同时可以修改钱包密码。</p>\n    </div>\n    <p class=\"textarea-error-msg\">{{mnemonicError}}</p>\n    <textarea class=\"mnemonic\" placeholder=\"输入助记词，用空格分隔\" @blur=\"mnemonicInput\" :class=\"{error: mnemonicError.length >= 1}\" v-model=\"mnemonic\"></textarea>\n    <div class=\"from\">\n      <p class=\"from-title\">恢复数字钱包</p>\n      <div class=\"from-item first-item\">\n        <input v-model=\"userName\" :class=\"{error: userNameError.length >= 1}\" @blur=\"userNameBlur\" placeholder=\"请输入用户名\" maxlength=\"20\">\n        <div class=\"error-msg\">{{userNameError}}</div>\n      </div>\n      <div class=\"from-item\">\n        <input type=\"password\" v-model=\"pwd\" :class=\"{error: pwdError.length >= 1}\" @input=\"pwdInput\" placeholder=\"请输入密码8-24位，建议混合大小写字母、数字\" maxlength=\"24\">\n        <div class=\"error-msg\">{{pwdError}}</div>\n      </div>\n      <div class=\"from-item\">\n        <input v-model=\"confirmPwd\" type=\"password\" @input=\"confirmPwdInput\" :class=\"{error: confirmPwdError.length >= 1}\" placeholder=\"请再次输入密码\" maxlength=\"24\">\n        <div class=\"error-msg\">{{confirmPwdError}}</div>\n      </div>\n    </div>\n    <div class=\"button\">\n      <button :class=\"{'btn':true,'btn-disabled': btnDisabled}\" @click=\"recover\" :disabled=\"btnDisabled\">恢复身份</button>\n    </div>\n  </div>\n</template>\n\n<script>\nimport { Toast } from 'vant'\nimport { userLogin, getBalance, getUserInfo } from '@/api/create'\nimport { sendSignData } from '@/api/sign'\nexport default {\n  data () {\n    return {\n      mnemonic: '',\n      mnemonicError: '',\n      userName: '',\n      userNameError: '',\n      pwd: '',\n      confirmPwd: '',\n      pwdError: '',\n      confirmPwdError: '',\n      btnDisabled: true,\n    }\n  },\n  created () {\n    document.onkeyup = (e) => {\n      let key = window.event.keyCode\n      if (key === 13) {\n        if (!this.btnDisabled) {\n          this.recover()\n        }\n      }\n    }\n  },\n  methods: {\n    // 助记词验证\n    mnemonicInput () {\n      let mnemonic = this.mnemonic\n      let result = this.$bip39.validateMnemonic(mnemonic)\n      let msg = '';\n      if (!mnemonic) {\n        msg = '请输入助记词'\n        this.btnDisabled = true\n      } else if (!result) {\n        msg = '输入的助记词格式有误'\n        this.btnDisabled = true\n      } else {\n        this.btnDisabled = false\n      }\n      this.mnemonicError = msg;\n    },\n    // 用户名\n    userNameBlur () {\n      let userName = this.userName\n      let msg = ''\n      if (!userName) {\n        msg = '请输入用户名'\n        this.btnDisabled = true\n      } else {\n        this.btnDisabled = false\n      }\n      this.userNameError = msg\n    },\n    // 密码验证\n    pwdInput () {\n      let pwd = this.pwd\n      let msg = '';\n      if (!pwd) {\n        msg = '请输入密码'\n        this.btnDisabled = true\n      } else if (pwd.length < 8) {\n        msg = '请输入至少8位字符的密码'\n        this.btnDisabled = true\n      } else if (pwd.length > 24) {\n        msg = '请输入不超过24位字符的密码'\n        this.btnDisabled = true\n      } else if (!(/^(?![0-9]+$)(?![a-z]+$)(?![A-Z]+$)(?!([^(0-9a-zA-Z)])+$).{8,24}$/).test(pwd)) {\n        msg = '请输入数字、字母或字符组合的密码'\n        this.btnDisabled = true\n      } else {\n        this.btnDisabled = false\n      }\n      this.pwdError = msg;\n    },\n    // 确认密码\n    confirmPwdInput () {\n      let pwd = this.pwd\n      let confirmPwd = this.confirmPwd\n      let msg = ''\n      if (!confirmPwd) {\n        msg = '请再次输入密码'\n        this.btnDisabled = true\n      } else if (pwd !== confirmPwd) {\n        msg = '两次密码输入不一致'\n        this.btnDisabled = true\n      } else {\n        this.btnDisabled = false\n      }\n      this.confirmPwdError = msg\n    },\n    // 回退\n    back () {\n      this.$router.go(-1)\n    },\n    // 恢复身份\n    async recover () {\n      this.mnemonicInput()\n      this.pwdInput()\n      this.confirmPwdInput()\n      let pwdError = this.pwdError\n      let confirmPwdError = this.confirmPwdError\n      let mnemonicError = this.mnemonicError\n      let userNameError = this.userNameError\n      if (pwdError || confirmPwdError || mnemonicError || userNameError) {\n        return false\n      } else {\n        let pwd = this.pwd\n        let mnemonic = this.mnemonic\n        let userName = this.userName\n        // 生成 keystore\n        let base58 = this.$bip44.mnemonicToHDPrivateKey(mnemonic, null)\n        let pk = this.$bip44.getPrivateKey(base58, 0).toString('hex')\n        let obj = this.$cwv.KeyPair.genFromPrikey(pk)\n        let keystore = this.$cwv.keystore.exportJSON(obj, pwd)\n        console.log(obj)\n        console.log(keystore)\n        // const recoverToast = Toast.loading({\n        //   duration: 0,\n        //   mask: true,\n        //   message: '恢复中...'\n        // })\n        // getUserInfo({ address: obj.hexAddress }).then((res) => {\n        //   console.log('获取用户名', res)\n        //   if (res.status === 200) {\n        //     if (res.data.errCode && res.data.errCode === -1) {\n        //       recoverToast.clear()\n        //       Toast({\n        //         duration: 1000,\n        //         message: res.data.errMsg\n        //       })\n        //       return false\n        //     }\n        //     const recoverName = res.data.alias\n        // 注册钱包地址\n        let params = {\n          method: 'BrokerInfo',\n          from: obj.hexAddress,\n          jsbody: JSON.stringify({\n            uinfo: {\n              alias: userName\n            }\n          }),\n          refid: new Date() - 0\n        }\n        const recoverToast = Toast.loading({\n          duration: 0,\n          mask: true,\n          message: '恢复中...'\n        })\n        var balance = 0\n        chrome.storage.local.set({\n                    keypair: obj,\n                    keystore,\n                    state: 'HAVE',\n                    balance,\n                    username: userName\n                  }, function () {\n                  })\n                  chrome.extension.getBackgroundPage().GlobalState = 'OPEN'\n                  this.sendMessageToContentScript({ msg: 'confirm -> content; 传递钱包地址', type: 'SENDMONEYADDRESS', data: { moneyAddress: obj.hexAddress, balance } }, (response) => {\n                    console.log(response)\n                  })\n                  Toast({\n                    duration: 1000,\n                    message: '恢复身份成功！'\n                  })\n                  this.$router.replace({ name: 'login' })\n        return\n        userLogin(params).then((res) => {\n          if (res.status === 200 && res.data.ret_code === 0) {\n            // 注册返回data 进行签名\n            let ecHexSign = this.$cwv2.ecHexSign(obj.hexPrikey, res.data.hexdata)\n            console.log('ecHexSign', ecHexSign)\n            let params2 = {\n              signdata: ecHexSign,\n              method: res.data.method,\n              waitResp: true,\n              from: res.data.from,\n              hexdata: res.data.hexdata,\n              refid: res.data.refid,\n              resp_refid: res.data.resp_refid\n            }\n            console.log('send_sign', params2)\n            sendSignData(params2).then((res) => {\n              console.log('res', res)\n              if (res.status === 200 && res.data.ret_code >= 0) {\n                recoverToast.clear()\n                let balance = ''\n                getBalance({ address: obj.hexAddress }).then((res) => {\n                  if (res.status === 200 && res.data.retCode < 0) {\n                    balance = 0\n                  }\n                  if (res.status === 200 && res.data.retCode >= 0) {\n                    console.log(res)\n                    if (res.data.account.value.hasOwnProperty(\"tokens\")) {\n                      let index = res.data.account.value.tokens.findIndex(v => {\n                        return v.token === \"AAA\"\n                      })\n                      if (index >= 0) {\n                        // balance = divide(res.data.account.value.tokens[index].balance, 10 ** 18)\n                        balance = (res.data.account.value.tokens[index].balance / 1000000000000000000).toFixed(0)\n                      }\n                    }\n                    else {\n                      balance = 0\n                    }\n                  }\n                  // 存储 keyStorage keyPair\n                  chrome.storage.local.set({\n                    keypair: obj,\n                    keystore,\n                    state: 'HAVE',\n                    balance,\n                    username: userName\n                  }, function () {\n                  })\n                  chrome.extension.getBackgroundPage().GlobalState = 'OPEN'\n                  this.sendMessageToContentScript({ msg: 'confirm -> content; 传递钱包地址', type: 'SENDMONEYADDRESS', data: { moneyAddress: obj.hexAddress, balance } }, (response) => {\n                    console.log(response)\n                  })\n                  Toast({\n                    duration: 1000,\n                    message: '恢复身份成功！'\n                  })\n                  this.$router.replace({ name: 'login' })\n                }).catch((err) => {\n                  console.log(err)\n                })\n              } else if (res.status === 200 && res.data.ret_code < 0) {\n                Toast({\n                  duration: 1000,\n                  message: res.data.ret_message\n                })\n              }\n            }).catch((err) => {\n              console.log(err)\n              Toast.clear()\n            })\n          } else {\n            recoverToast.clear()\n            Toast({\n              duration: 1000,\n              message: res.data.ret_message\n            })\n          }\n        }).catch((err) => {\n          recoverToast.clear()\n          Toast({\n            duration: 1000,\n            message: '注册信息失败'\n          })\n        })\n        // } else {\n        //   recoverToast.clear()\n        //   Toast({\n        //     duration: 1000,\n        //     message: res.data.errMsg\n        //   })\n        // }\n        // }).catch((err) => {\n        //   recoverToast.clear()\n        //   Toast({\n        //     duration: 1000,\n        //     message: '获取用户信息失败！'\n        //   })\n        // })\n      }\n    },\n    // 发送信息给content_script\n    getCurrentTabId (callback) {\n      chrome.tabs.query({ active: true, currentWindow: true }, function (tabs) {\n        if (callback) callback(tabs.length ? tabs[0].id : null);\n      })\n    },\n    sendMessageToContentScript (message, callback) {\n      this.getCurrentTabId((tabId) => {\n        chrome.tabs.sendMessage(tabId, message, function (response) {\n          if (callback) callback(response)\n        })\n      })\n    }\n  }\n}\n</script>\n\n<style lang=\"less\" scoped>\n.recover {\n  width: 100%;\n  height: 100%;\n  padding: 20px;\n  .header {\n    font-size: 16px;\n    .van-icon-arrow-left {\n      cursor: pointer;\n      color: #516fea;\n    }\n  }\n  .title {\n    width: 100%;\n    margin-top: 20px;\n    text-align: center;\n    h2 {\n      font-size: 18px;\n      font-family: PingFangSC-Medium;\n      font-weight: 500;\n      color: rgba(0, 0, 0, 0.85);\n      line-height: 24px;\n    }\n    p {\n      font-size: 14px;\n      margin-top: 6px;\n      font-family: PingFangSC-Light;\n      font-weight: 300;\n      color: rgba(0, 0, 0, 0.65);\n      line-height: 20px;\n    }\n  }\n  .textarea-error-msg {\n    height: 16px;\n    margin-top: 10px;\n    text-align: center;\n    font-size: 12px;\n    font-family: PingFangSC-Regular;\n    font-weight: 400;\n    color: rgba(246, 34, 46, 1);\n    line-height: 16px;\n  }\n  .mnemonic {\n    width: 100%;\n    height: 127px;\n    margin-top: 4px;\n    background: rgba(0, 0, 0, 0.04);\n    border-radius: 4px;\n    border: none;\n    font-size: 14px;\n    font-family: PingFangSC-Light;\n    font-weight: 300;\n    color: rgba(0, 0, 0, 0.85);\n    line-height: 20px;\n    padding: 10px;\n    resize: none;\n    &.error {\n      border: 1px solid rgba(246, 34, 46, 1);\n    }\n  }\n  .from {\n    margin-top: 20px;\n    &-title {\n      font-size: 14px;\n      text-align: left;\n      font-family: PingFangSC-Regular;\n      font-weight: 400;\n      color: rgba(0, 0, 0, 0.85);\n      line-height: 20px;\n    }\n    &-item {\n      margin-top: 24px;\n      height: 34px;\n      position: relative;\n      &:last-child {\n        margin-bottom: 24px;\n      }\n      input {\n        font-size: 14px;\n        height: 100%;\n        font-family: PingFangSC-Light;\n        font-weight: 400;\n        color: rgba(0, 0, 0, 0.85);\n        line-height: 20px;\n        padding: 0;\n        border-bottom: 1px solid rgba(0, 0, 0, 0.12);\n      }\n      input.error {\n        border-color: rgba(246, 34, 46, 1);\n      }\n      .error-msg {\n        text-align: left;\n        font-size: 12px;\n        font-family: PingFangSC-Regular;\n        font-weight: 400;\n        color: rgba(246, 34, 46, 1);\n        line-height: 18px;\n      }\n    }\n    .first-item {\n      margin-top: 10px;\n    }\n  }\n  .button {\n    text-align: center;\n    margin-top: 35px;\n    width: 100%;\n    .btn {\n      width: 283px;\n      height: 48px;\n      background: rgba(51, 76, 169, 1);\n      border-radius: 4px;\n      border: 1px solid rgba(51, 76, 169, 1);\n      font-size: 13px;\n      font-family: PingFangSC-Medium;\n      font-weight: 500;\n      color: rgba(255, 255, 255, 1);\n    }\n    .btn-disabled {\n      background: rgba(174, 184, 221, 1);\n      color: rgba(255, 255, 255, 1);\n      border: 1px solid rgba(174, 184, 221, 1);\n    }\n  }\n}\n</style>\n"]}]}